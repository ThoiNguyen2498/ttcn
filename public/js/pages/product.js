$(document).ready(function(){openPopup('.buy-now','.popup');closePopup('.popup_close','.popup');$('#image-gallery').lightSlider({item:4,loop:false,slideMargin:5,controls:true,speed:600,keyPress:true,freeMove:true,enableDrag:true,enableTouch:true,currentPagerPosition:'middle',thumbItem:5,auto:false,onSliderLoad:function(el){el.lightGallery({download:false,selector:'#image-gallery .lslide',});}});$('.slide_video').owlCarousel({loop:false,margin:10,autoplay:false,nav:true,dots:false,smartSpeed:500,mouseDrag:true,pullDrag:true,touchDrag:true,responsive:{0:{items:3},600:{items:3},1000:{items:3}}});$(".owl-prev").html('<i class="fa fa-chevron-left" aria-hidden="true"></i>');$(".owl-next").html('<i class="fa fa-chevron-right" aria-hidden="true"></i>');$('#slider_video_home .iframe').each(function(){var ifa=$(this).attr('data-iframe');var videoid=getIdVideo(ifa);var replacement='<iframe src="https://www.youtube.com/embed/'+videoid[1]+'" frameborder="0" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe>';$(this).html(replacement);});$('#slide_video .item').each(function(){var ifa=$(this).attr('data-iframe');var thum=getThumbYoutube(getUrlYoutube(ifa),'big');$(this).append("<img src='"+thum+"' alt=''>");});$('#slide_video .item').on('click',function(){var embed=getIdYoutube($(this).attr('data-iframe'));$('#slider_video_home .iframe').html(embed);});$('.show-lightbox-btn').click(function(){$('.lightbox').css('display','block');});$('.close-lightbox-btn').click(function(){$('.lightbox').css('display','none');});$('#product-detail-viewall').click(function(){$(this).css('display','none');$(this).parent().css('position','relative');$(this).parent().children('#product-detail-viewdefault').css('display','inline-block');$(this).parent().parent().children('.product-detail-content').css('height','auto');});$('#product-detail-viewdefault').click(function(){$(this).css('display','none');$(this).parent().css('position','absolute');$(this).parent().children('#product-detail-viewall').css('display','inline-block');$(this).parent().parent().children('.product-detail-content').animate({height:'1000px'},1000);});$('.product-detail-viewall').click(function(){$(this).css('display','none');$(this).parent().css('position','relative');$(this).parent().children('.product-detail-viewdefault').css('display','inline-block');$(this).parent().parent().children('.product-detail-content').css('height','auto');});$('.product-detail-viewdefault').click(function(){$(this).css('display','none');$(this).parent().css('position','absolute');$(this).parent().children('.product-detail-viewall').css('display','inline-block');$(this).parent().parent().children('.product-detail-content').animate({height:'550px'},500);});$('.rating-star').on('click','i',function(){value_star=$(this).data('value');$('#rating').val(value_star);$('.rating-star').empty();var j=0;for(var i=0;i<value_star;i++){j++;$('.rating-star').append('<i class="fa start fa-star" data-value="'+j+'" aria-hidden="true"></i>');}
for(var i=0;i<5-value_star;i++){j++;$('.rating-star').append('<i class="fa start fa-star-o" data-value="'+j+'" aria-hidden="true"></i>');}});var boxParentFullHeight=$('.product-content-right').outerHeight();var boxParentWidth=$('.product-content-right').width();var boxChildOffset=$('.product-summary').offset();var startFix=boxChildOffset.top;$(window).scroll(function(){var yaBox=$('.fix-content-right').outerHeight();var endFix=startFix+yaBox-boxParentFullHeight;var fromTop=jQuery(document).scrollTop();if(fromTop>startFix){if(fromTop>endFix){var stopFix=yaBox-boxParentFullHeight;$('.product-summary').css({'position':'absolute','top':stopFix});}else{$('.product-summary').css({'position':'fixed','top':'10px','width':boxParentWidth});}}else{$('.product-summary').css({'position':'relative','top':'0','width':'100%'});}});})
function filter(dataAttribute,option){return dataAttribute.filter(function(item){for(var key in option){if(item[key]!=option[key]){return false;}}
return true;});}
function change_price(dataAttribute,price,warranty,custom_key,parent,price_number,price_sg){var currenWarranty=$(parent+' '+warranty).val();var location_price=$('#location').val();var currenColor=0;var currentStorage=0;var currentAspect=0;var currentRam=0;var currentPrice=0;var currentMadeby=0;location_address=1;for(var i=0;i<custom_key.length;i++){switch(custom_key[i]){case 'color':currenColor=$(parent+' .'+custom_key[i]+".active").data('color');break;case 'storage':currentStorage=$(parent+' .'+custom_key[i]).val();break;case 'madeby':currentMadeby=$(parent+' .'+custom_key[i]).val();break;case 'aspect':currentAspect=$(parent+' .'+custom_key[i]).val();break;case 'ram':currentRam=$(parent+' .'+custom_key[i]).val();break;}}
data={};if(currenColor!=0){data["color"]=currenColor;}
if(currentStorage!=0){data["storage"]=currentStorage;}
if(currentMadeby!=0){data["madeby"]=currentMadeby;}
if(currentAspect!=0){data["aspect"]=currentAspect;}
if(currentRam!=0){data["ram"]=currentRam;}
var res=filter(dataAttribute,data);if(res.length!=0){$(price).empty();if(price_number==0){$(price).empty();$(price).append("Liên hệ");}else if(price_number==68000000){$(price).empty();$(price).append("Liên hệ");}else{currentPrice=res[0]["price"];if(price_sg)
if(location_price==location_address){var price_sg=0;}else{var price_sg=''+price_sg+'';}
else{var price_sg=0;}
currentPrice=parseInt(currentPrice)+parseInt(currenWarranty)+parseInt(price_sg);$(price).append(format_price(currentPrice));}
return res;}else{$(price).empty();if(price_number)
if(price_number==68000000){price_current="Liên hệ";current=68000000;}else if(price_number==0){price_current="Liên hệ";current=0;}else{if(location_price==location_address){price_current=format_price(price_number);current=price_number;}else{if(price_sg){price_current=format_price(price_number+price_sg);current=price_number+price_sg;}
else{price_current=format_price(price_number);current=price_number;}}}
else{price_current="Liên hệ";}
$(price).append(price_current);res=[{'price':current,'color_name':'Không','storage':'Không','aspect':'Không'}];return res;}}
function change_price_popup(dataAttribute,price,warranty,custom_key,parent,price_number,price_sg){var currenWarranty=$(parent+' '+warranty).val();var location_price=$('#customer-location').val();var currenColor=0;var currentStorage=0;var currentAspect=0;var currentRam=0;var currentPrice=0;var currentMadeby=0;location_address=1;for(var i=0;i<custom_key.length;i++){switch(custom_key[i]){case 'color':currenColor=$(parent+' .'+custom_key[i]+".active").data('color');break;case 'storage':currentStorage=$(parent+' .'+custom_key[i]).val();break;case 'madeby':currentMadeby=$(parent+' .'+custom_key[i]).val();break;case 'aspect':currentAspect=$(parent+' .'+custom_key[i]).val();break;case 'ram':currentRam=$(parent+' .'+custom_key[i]).val();break;}}
data={};if(currenColor!=0){data["color"]=currenColor;}
if(currentStorage!=0){data["storage"]=currentStorage;}
if(currentMadeby!=0){data["madeby"]=currentMadeby;}
if(currentAspect!=0){data["aspect"]=currentAspect;}
if(currentRam!=0){data["ram"]=currentRam;}
var res=filter(dataAttribute,data);if(res.length!=0){$(price).empty();if(price_number==0){$(price).empty();$(price).append("Liên hệ");}else if(price_number==68000000){$(price).empty();$(price).append("Liên hệ");}else{currentPrice=res[0]["price"];if(price_sg)
if(location_price==location_address){var price_sg=0;}else{var price_sg=''+price_sg+'';}
else{var price_sg=0;}
currentPrice=parseInt(currentPrice)+parseInt(currenWarranty)+parseInt(price_sg);$(price).append(format_price(currentPrice));}
return res;}else{$(price).empty();if(price_number)
if(price_number==68000000){price_current="Liên hệ";current=68000000;}else if(price_number==0){price_current="Liên hệ";current=0;}else{if(location_price==location_address){price_current=format_price(price_number);current=price_number;}else{if(price_sg){price_current=format_price(price_number+price_sg);current=price_number+price_sg;}
else{price_current=format_price(price_number);current=price_number;}}}
else{price_current="Liên hệ";}
$(price).append(price_current);res=[{'price':current,'color_name':'Không','storage':'Không','aspect':'Không'}];return res;}}
function gender_param(custom_key,colorArray,storageArray,aspectArray,ramArray,madebyArray){for(var i=0;i<custom_key.length;i++){switch(custom_key[i]){case 'color':$('.color-list').empty();$('.color-list').append('<p>Màu Sắc</p>');colorArray.forEach(function(element,index){$('.color-list').append("<div data-color="+element+" style='background-color:"+element+";' class='color-item "+custom_key[i]+"'></div>");$('.color-item:first').addClass('active');});break;case 'storage':$('.custom-param-list').append("<div class='custom-param-item'><p>Chọn bộ nhớ </p><select class='param-option "+custom_key[i]+"'></select></div>");storageArray.forEach(function(element,index){if(element!=undefined){$('.custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;case 'madeby':$('.custom-param-list').append("<div class='custom-param-item'><p>Xuất xứ </p><select class='param-option "+custom_key[i]+"'></select></div>");madebyArray.forEach(function(element,index){if(element!=undefined){$('.custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;case 'aspect':$('.custom-param-list').append("<div class='custom-param-item'><p>Tình trạng </p><select class='param-option "+custom_key[i]+"'></select></div>");aspectArray.forEach(function(element,index){if(element!=undefined){$('.custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;case 'ram':$('.product-price-content').append('<div class="ram-box"></div>')
$('.ram-box').append("<p>Bộ nhớ trong </p><select class='param-option "+custom_key[i]+"'></select>");ramArray.forEach(function(element,index){if(element!=undefined){$('.'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;}}}
function gender_param_popup(custom_key,colorArray,storageArray,aspectArray,ramArray,madebyArray){for(var i=0;i<custom_key.length;i++){switch(custom_key[i]){case 'color':$('.popup-color-list').empty();$('.popup-color-list').append('<p>Màu Sắc</p>');colorArray.forEach(function(element,index){$('.popup-color-list').append("<div data-color="+element+" style='background-color:"+element+";' class='popup-color-item "+custom_key[i]+"'></div>");$('.popup-color-item:first').addClass('active');});break;case 'storage':$('.popup-custom-param-list').append("<div class='popup-custom-param-item'><p>Chọn bộ nhớ </p><select class='popup-param-option "+custom_key[i]+"'></select></div>");storageArray.forEach(function(element,index){if(element!=undefined){$('.popup-custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;case 'aspect':$('.popup-custom-param-list').append("<div class='popup-custom-param-item'><p>Tình trạng máy </p><select class='popup-param-option "+custom_key[i]+"'></select></div>");aspectArray.forEach(function(element,index){if(element!=undefined){$('.popup-custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;case 'ram':$('.popup-custom-param-list').append("<div class='popup-custom-param-item'><p>Ram </p><select class='popup-param-option "+custom_key[i]+"'></select></div>");ramArray.forEach(function(element,index){if(element!=undefined){$('.popup-custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;case 'madeby':$('.popup-custom-param-list').append("<div class='popup-custom-param-item'><p>Xuất xứ </p><select class='popup-param-option "+custom_key[i]+"'></select></div>");madebyArray.forEach(function(element,index){if(element!=undefined){$('.popup-custom-param-list .'+custom_key[i]).append("<option value='"+element+"'>"+element+"</option>");}});break;}}}
function select_param(dataAttribute,custom_key,price_number,price_sg){$('body').on('change','#location',function(){change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);});$('.color-item').on('click',function(){var el=$(this);$('.color-item').removeClass('active');$('.color-item').empty();el.addClass('active');value=change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);if(value[0]['image']){$('.product_image li').removeClass('active').hide();$('.product_image img[src="'+resizeImage(value[0]['image'])+'"]').parent().last().fadeIn(function(){$(this).addClass('active');});}else{$('.product_image li:first').addClass('active');}});$('.product-price-content .storage').on('change',function(){change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);});$('.product-price-content .aspect').on('change',function(){change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);});$('.product-price-content .warranty').on('change',function(){change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);});$('.product-price-content .ram').on('change',function(){change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);});$('.product-price-content .madeby').on('change',function(){change_price(dataAttribute,'.price-and-color .price','.warranty',custom_key,'.product-price-content',price_number,price_sg);});}
function select_param_popup(dataAttribute,custom_key,price_number,price_sg){$('.popup-color-item').on('click',function(){var el=$(this);$('.popup-color-item').removeClass('active');$('.popup-color-item').empty();el.addClass('active');change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});$('.popup-custom-param-item .storage').on('change',function(){change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});$('.popup-custom-param-item .aspect').on('change',function(){change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});$('.popup-custom-param-item .ram').on('change',function(){change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});$('.popup-warranty').on('change',function(){change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});$('.popup-custom-param-item .madeby').on('change',function(){change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});$('body').on('change','#customer-location',function(){change_price_popup(dataAttribute,'.popup_product_price','.popup-warranty',custom_key,'.popup_product_info',price_number,price_sg);});}
function order(value,product_name,product_id,type){if(value[0]['price']=="Liên hệ"){price=0;}else{price=value[0]['price'];}
_token=$('#_token').val();name=type;product_id=product_id;product_name=product_name;warranty=$('.popup-warranty option:selected').text();link=window.location.href;info=value;price=price;gender=$('#customer-gender').val();cname=$('#customer-name').val();phone=$('#customer-phone').val();email=$('#customer-email').val();cuslocation=$('#customer-location').val();address=$('#customer-address').val();note=$('#order-note').val();if(cname==""||phone==""||email==""){alert('Thông tin bắt buộc cần nhập đầy đủ!');}else if(!validateEmail(email)){alert('Định dạng email chưa chính xác!');}else{data_order={'_token':_token,'name':name,'product_id':product_id,'product_name':product_name,'warranty':warranty,'link':link,'info':info,'price':price,'gender':gender,'cname':cname,'phone':phone,'email':email,'cuslocation':cuslocation,'address':address,'note':note};loadAjax('../ajax/orders',data_order,{beforeSend:function(){$("#loading_box").css({visibility:"visible",opacity:0.0}).animate({opacity:1.0},200);},success:function(result){$("#loading_box").animate({opacity:0.0},200,function(){$("#loading_box").css("visibility","hidden");});$('#customer-name').val('');$('#customer-phone').val('');$('#customer-email').val('');$('#customer-address').val('');$('#order-note').val('');$(".popup").bPopup().close();$('.alert_message').empty().append(result).css('display','block');setInterval(function(){$('.alert_message').fadeOut(1000);},5000);},error:function(error){$("#loading_box").animate({opacity:0.0},200,function(){$("#loading_box").css("visibility","hidden");});$.alert('Có lỗi xảy ra! Vui lòng thử lại.');}});}}